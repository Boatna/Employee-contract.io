<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Voice-Alarm Pro - ระบบตั้งเวลาเสียงอัปโหลดเอง</title>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <style>
    /* CSS Variables for Theme */
    :root {
      /* Light Theme */
      --primary-color: #4361ee;
      --primary-light: #e0e7ff;
      --secondary-color: #3a0ca3;
      --accent-color: #f72585;
      --success-color: #4cc9f0;
      --warning-color: #f8961e;
      --danger-color: #f94144;
      --info-color: #4895ef;
      
      --bg-primary: #ffffff;
      --bg-secondary: #f8f9ff;
      --bg-tertiary: #f1f3ff;
      
      --text-primary: #1a1a2e;
      --text-secondary: #495057;
      --text-muted: #6c757d;
      
      --border-color: #e2e8ff;
      --border-radius: 16px;
      --border-radius-sm: 10px;
      
      --shadow-sm: 0 2px 8px rgba(67, 97, 238, 0.08);
      --shadow-md: 0 4px 16px rgba(67, 97, 238, 0.12);
      --shadow-lg: 0 8px 30px rgba(67, 97, 238, 0.15);
      --shadow-xl: 0 15px 40px rgba(67, 97, 238, 0.2);
      
      --header-gradient: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
      --card-gradient: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);
      
      --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }
    
    /* Dark Theme */
    .dark-mode {
      --primary-color: #6d8cff;
      --primary-light: #2d3748;
      --secondary-color: #9f7aea;
      --accent-color: #ed64a6;
      --success-color: #68d391;
      --warning-color: #f6ad55;
      --danger-color: #fc8181;
      --info-color: #76e4f7;
      
      --bg-primary: #1a202c;
      --bg-secondary: #2d3748;
      --bg-tertiary: #4a5568;
      
      --text-primary: #f7fafc;
      --text-secondary: #e2e8f0;
      --text-muted: #a0aec0;
      
      --border-color: #4a5568;
      --border-radius: 16px;
      
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);
      --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.4);
      --shadow-lg: 0 8px 30px rgba(0, 0, 0, 0.5);
      --shadow-xl: 0 15px 40px rgba(0, 0, 0, 0.6);
      
      --header-gradient: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
      --card-gradient: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
    }
    
    /* Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Sarabun', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      color: var(--text-primary);
      transition: var(--transition);
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: var(--bg-primary);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-xl);
      overflow: hidden;
      transition: var(--transition);
    }
    
    /* Header */
    header {
      background: var(--header-gradient);
      padding: 35px 30px;
      text-align: center;
      color: white;
      position: relative;
      overflow: hidden;
    }
    
    header::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      opacity: 0.3;
    }
    
    .header-content {
      position: relative;
      z-index: 2;
    }
    
    h1 {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }
    
    .subtitle {
      font-size: 1.1rem;
      opacity: 0.9;
      max-width: 700px;
      margin: 0 auto;
      line-height: 1.6;
    }
    
    /* Controls Bar */
    .controls-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 30px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
    }
    
    .time-display {
      font-size: 1.3rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--text-primary);
    }
    
    .control-buttons {
      display: flex;
      gap: 10px;
    }
    
    .theme-toggle, .sound-toggle {
      background: var(--bg-primary);
      border: 2px solid var(--border-color);
      color: var(--text-primary);
      width: 44px;
      height: 44px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      transition: var(--transition);
    }
    
    .theme-toggle:hover, .sound-toggle:hover {
      background: var(--primary-light);
      border-color: var(--primary-color);
      transform: translateY(-2px);
    }
    
    /* Main Content */
    .main-content {
      padding: 30px;
    }
    
    .section {
      background: var(--card-gradient);
      padding: 25px;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-md);
      margin-bottom: 25px;
      border: 1px solid var(--border-color);
      transition: var(--transition);
    }
    
    .section:hover {
      box-shadow: var(--shadow-lg);
    }
    
    .section-title {
      font-size: 1.4rem;
      font-weight: 600;
      margin-bottom: 20px;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 10px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--primary-light);
    }
    
    .section-title i {
      color: var(--primary-color);
    }
    
    /* Upload Section */
    .upload-zone {
      border: 3px dashed var(--border-color);
      border-radius: var(--border-radius-sm);
      padding: 30px;
      text-align: center;
      background: var(--bg-primary);
      transition: var(--transition);
      cursor: pointer;
      margin-bottom: 20px;
    }
    
    .upload-zone:hover, .upload-zone.dragover {
      border-color: var(--primary-color);
      background: var(--primary-light);
    }
    
    .upload-icon {
      font-size: 3rem;
      color: var(--primary-color);
      margin-bottom: 15px;
    }
    
    .upload-text h4 {
      font-size: 1.3rem;
      margin-bottom: 8px;
      color: var(--text-primary);
    }
    
    .upload-text p {
      color: var(--text-muted);
      font-size: 0.95rem;
    }
    
    .upload-btn {
      display: inline-block;
      margin-top: 15px;
      padding: 12px 25px;
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: var(--border-radius-sm);
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .upload-btn:hover {
      background: var(--secondary-color);
      transform: translateY(-2px);
    }
    
    /* Sound Slots */
    .sound-slots {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .sound-slot {
      background: var(--bg-primary);
      border-radius: var(--border-radius-sm);
      padding: 20px;
      border: 2px solid var(--border-color);
      transition: var(--transition);
      position: relative;
    }
    
    .sound-slot.active {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px var(--primary-light);
    }
    
    .sound-slot-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .slot-title {
      font-weight: 600;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .slot-badge {
      background: var(--primary-color);
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 500;
    }
    
    .slot-content {
      margin-top: 15px;
    }
    
    .audio-preview {
      background: var(--bg-secondary);
      border-radius: var(--border-radius-sm);
      padding: 15px;
      margin-bottom: 15px;
    }
    
    .audio-name {
      font-weight: 600;
      margin-bottom: 5px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .audio-meta {
      display: flex;
      justify-content: space-between;
      color: var(--text-muted);
      font-size: 0.9rem;
    }
    
    .slot-actions {
      display: flex;
      gap: 10px;
    }
    
    /* Buttons */
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: var(--border-radius-sm);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: var(--transition);
      text-decoration: none;
    }
    
    .btn-primary {
      background: var(--primary-color);
      color: white;
    }
    
    .btn-primary:hover {
      background: var(--secondary-color);
      transform: translateY(-2px);
    }
    
    .btn-success {
      background: var(--success-color);
      color: white;
    }
    
    .btn-success:hover {
      background: #38b2ac;
      transform: translateY(-2px);
    }
    
    .btn-danger {
      background: var(--danger-color);
      color: white;
    }
    
    .btn-danger:hover {
      background: #dc2626;
      transform: translateY(-2px);
    }
    
    .btn-warning {
      background: var(--warning-color);
      color: white;
    }
    
    .btn-warning:hover {
      background: #d97706;
      transform: translateY(-2px);
    }
    
    .btn-sm {
      padding: 8px 16px;
      font-size: 0.9rem;
    }
    
    /* Schedule List */
    .schedule-list {
      margin-top: 10px;
    }
    
    .schedule-item {
      background: var(--bg-primary);
      border-radius: var(--border-radius-sm);
      padding: 20px;
      margin-bottom: 15px;
      border: 1px solid var(--border-color);
      transition: var(--transition);
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .schedule-item:hover {
      border-color: var(--primary-color);
      box-shadow: var(--shadow-sm);
    }
    
    .schedule-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .schedule-time {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--primary-color);
      background: var(--primary-light);
      padding: 8px 16px;
      border-radius: var(--border-radius-sm);
    }
    
    .schedule-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }
    
    .detail-item {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    
    .detail-label {
      font-size: 0.9rem;
      color: var(--text-muted);
      font-weight: 500;
    }
    
    .detail-value {
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .schedule-actions {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    
    .empty-state {
      text-align: center;
      padding: 50px 20px;
      color: var(--text-muted);
    }
    
    .empty-icon {
      font-size: 4rem;
      margin-bottom: 20px;
      opacity: 0.5;
    }
    
    .empty-text h3 {
      font-size: 1.5rem;
      margin-bottom: 10px;
      color: var(--text-muted);
    }
    
    .empty-text p {
      font-size: 1rem;
    }
    
    /* Status Bar */
    .status-bar {
      background: var(--bg-secondary);
      padding: 20px;
      border-radius: var(--border-radius-sm);
      margin: 25px 0;
      text-align: center;
      border: 2px solid var(--border-color);
      transition: var(--transition);
    }
    
    .status-bar.running {
      border-color: var(--success-color);
      background: rgba(76, 201, 240, 0.1);
    }
    
    .status-indicator {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      font-size: 1.2rem;
      font-weight: 600;
    }
    
    .status-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--danger-color);
      animation: pulse 2s infinite;
    }
    
    .status-dot.running {
      background: var(--success-color);
      animation: pulse 1s infinite;
    }
    
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }
    
    /* Action Buttons */
    .action-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
      margin-top: 30px;
    }
    
    /* Notification Settings */
    .notification-settings {
      background: var(--bg-secondary);
      padding: 20px;
      border-radius: var(--border-radius-sm);
      margin-top: 20px;
    }
    
    .setting-options {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 15px;
    }
    
    .setting-option {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 18px;
      background: var(--bg-primary);
      border-radius: var(--border-radius-sm);
      border: 1px solid var(--border-color);
      transition: var(--transition);
      cursor: pointer;
    }
    
    .setting-option:hover {
      border-color: var(--primary-color);
    }
    
    .setting-option input {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }
    
    /* Toast Notification */
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
    }
    
    .toast {
      background: var(--bg-primary);
      color: var(--text-primary);
      padding: 16px 24px;
      border-radius: var(--border-radius-sm);
      box-shadow: var(--shadow-lg);
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 15px;
      max-width: 350px;
      transform: translateX(400px);
      opacity: 0;
      transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55), opacity 0.4s;
    }
    
    .toast.show {
      transform: translateX(0);
      opacity: 1;
    }
    
    .toast-icon {
      font-size: 1.5rem;
    }
    
    .toast-success .toast-icon {
      color: var(--success-color);
    }
    
    .toast-error .toast-icon {
      color: var(--danger-color);
    }
    
    .toast-warning .toast-icon {
      color: var(--warning-color);
    }
    
    .toast-info .toast-icon {
      color: var(--info-color);
    }
    
    .toast-content {
      flex: 1;
    }
    
    .toast-title {
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .toast-message {
      font-size: 0.95rem;
      color: var(--text-secondary);
    }
    
    /* Progress Bar */
    .progress-container {
      width: 100%;
      height: 8px;
      background: var(--border-color);
      border-radius: 4px;
      overflow: hidden;
      margin-top: 15px;
    }
    
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
      width: 0%;
      transition: width 0.3s ease;
      border-radius: 4px;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .container {
        border-radius: 0;
      }
      
      header {
        padding: 25px 20px;
      }
      
      h1 {
        font-size: 2rem;
        flex-direction: column;
        gap: 10px;
      }
      
      .controls-bar {
        flex-direction: column;
        gap: 15px;
        padding: 15px;
      }
      
      .main-content {
        padding: 20px;
      }
      
      .section {
        padding: 20px;
      }
      
      .sound-slots {
        grid-template-columns: 1fr;
      }
      
      .schedule-details {
        grid-template-columns: 1fr;
      }
      
      .action-buttons {
        flex-direction: column;
      }
      
      .action-buttons .btn {
        width: 100%;
      }
      
      .setting-options {
        flex-direction: column;
      }
    }
    
    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 10px;
    }
    
    ::-webkit-scrollbar-track {
      background: var(--bg-secondary);
      border-radius: 5px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--primary-color);
      border-radius: 5px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: var(--secondary-color);
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="header-content">
        <h1>
          <i class="fas fa-bell"></i>
          <span>Voice-Alarm Pro</span>
          <span class="version-badge">v2.0</span>
        </h1>
        <p class="subtitle">ระบบตั้งเวลาเสียงแบบอัปโหลดไฟล์เอง พร้อมการแจ้งเตือนล่วงหน้าและรองรับเสียงหลายรูปแบบ</p>
      </div>
    </header>
    
    <div class="controls-bar">
      <div class="time-display">
        <i class="fas fa-clock"></i>
        <span id="current-time">กำลังโหลดเวลา...</span>
      </div>
      <div class="control-buttons">
        <button class="theme-toggle" id="themeToggle" title="เปลี่ยนธีม">
          <i class="fas fa-moon"></i>
        </button>
        <button class="sound-toggle" id="soundToggle" title="เปิด/ปิดเสียง">
          <i class="fas fa-volume-up"></i>
        </button>
      </div>
    </div>
    
    <div class="main-content">
      <!-- Upload Section -->
      <div class="section">
        <h2 class="section-title">
          <i class="fas fa-cloud-upload-alt"></i>
          อัปโหลดเสียง
        </h2>
        
        <div class="upload-zone" id="uploadZone">
          <div class="upload-icon">
            <i class="fas fa-file-audio"></i>
          </div>
          <div class="upload-text">
            <h4>ลากไฟล์เสียงมาวางที่นี่</h4>
            <p>หรือคลิกเพื่อเลือกไฟล์ (รองรับ MP3, WAV, OGG)</p>
            <p class="file-size-note">ขนาดไฟล์ไม่เกิน 10MB</p>
          </div>
          <input type="file" id="audioFile" accept="audio/*" style="display: none;">
          <div class="upload-btn" id="uploadBtn">
            <i class="fas fa-search"></i> เลือกไฟล์เสียง
          </div>
        </div>
        
        <div class="sound-slots">
          <!-- Sound Slot 1 -->
          <div class="sound-slot" id="soundSlot1">
            <div class="sound-slot-header">
              <div class="slot-title">
                <i class="fas fa-music"></i>
                <span>เสียงที่ 1</span>
              </div>
              <div class="slot-badge" id="slot1Badge">ว่าง</div>
            </div>
            <div class="slot-content">
              <div class="audio-preview" id="audioPreview1">
                <div class="audio-empty" id="audioEmpty1">
                  <i class="fas fa-headphones" style="font-size: 2rem; color: var(--text-muted); margin-bottom: 10px;"></i>
                  <p>ยังไม่มีไฟล์เสียง</p>
                </div>
              </div>
              <div class="slot-actions">
                <button class="btn btn-primary btn-sm" onclick="selectSlot(1)">
                  <i class="fas fa-check"></i> เลือก
                </button>
                <button class="btn btn-success btn-sm" onclick="playSound(1)" id="playBtn1" disabled>
                  <i class="fas fa-play"></i> ทดลอง
                </button>
                <button class="btn btn-danger btn-sm" onclick="clearSound(1)" id="clearBtn1" disabled>
                  <i class="fas fa-trash"></i> ลบ
                </button>
              </div>
            </div>
          </div>
          
          <!-- Sound Slot 2 -->
          <div class="sound-slot" id="soundSlot2">
            <div class="sound-slot-header">
              <div class="slot-title">
                <i class="fas fa-music"></i>
                <span>เสียงที่ 2</span>
              </div>
              <div class="slot-badge" id="slot2Badge">ว่าง</div>
            </div>
            <div class="slot-content">
              <div class="audio-preview" id="audioPreview2">
                <div class="audio-empty" id="audioEmpty2">
                  <i class="fas fa-headphones" style="font-size: 2rem; color: var(--text-muted); margin-bottom: 10px;"></i>
                  <p>ยังไม่มีไฟล์เสียง</p>
                </div>
              </div>
              <div class="slot-actions">
                <button class="btn btn-primary btn-sm" onclick="selectSlot(2)">
                  <i class="fas fa-check"></i> เลือก
                </button>
                <button class="btn btn-success btn-sm" onclick="playSound(2)" id="playBtn2" disabled>
                  <i class="fas fa-play"></i> ทดลอง
                </button>
                <button class="btn btn-danger btn-sm" onclick="clearSound(2)" id="clearBtn2" disabled>
                  <i class="fas fa-trash"></i> ลบ
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Upload Progress -->
        <div id="uploadProgress" style="display: none;">
          <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
          </div>
          <p id="uploadStatus" style="text-align: center; margin-top: 10px; color: var(--text-muted);"></p>
        </div>
      </div>
      
      <!-- Schedule Section -->
      <div class="section">
        <h2 class="section-title">
          <i class="fas fa-clock"></i>
          ตั้งเวลา
        </h2>
        
        <div id="scheduleList" class="schedule-list">
          <!-- Schedules will be added here -->
        </div>
        
        <div class="empty-state" id="emptySchedule">
          <div class="empty-icon">
            <i class="fas fa-calendar-plus"></i>
          </div>
          <div class="empty-text">
            <h3>ยังไม่มีกำหนดการ</h3>
            <p>เพิ่มกำหนดการใหม่เพื่อเริ่มต้นใช้งาน</p>
          </div>
        </div>
        
        <div style="text-align: center; margin-top: 20px;">
          <button class="btn btn-primary" onclick="addNewSchedule()">
            <i class="fas fa-plus-circle"></i> เพิ่มกำหนดการใหม่
          </button>
        </div>
      </div>
      
      <!-- Notification Settings -->
      <div class="section">
        <h2 class="section-title">
          <i class="fas fa-bell"></i>
          การตั้งค่าการแจ้งเตือน
        </h2>
        
        <div class="notification-settings">
          <div class="setting-options">
            <label class="setting-option">
              <input type="checkbox" id="notify5min" checked>
              <span>แจ้งเตือนล่วงหน้า 5 นาที</span>
            </label>
            <label class="setting-option">
              <input type="checkbox" id="notify1min" checked>
              <span>แจ้งเตือนล่วงหน้า 1 นาที</span>
            </label>
            <label class="setting-option">
              <input type="checkbox" id="repeatSound">
              <span>เล่นเสียงซ้ำ 3 ครั้ง</span>
            </label>
            <label class="setting-option">
              <input type="checkbox" id="vibrateNotify">
              <span>สั่นเมื่อแจ้งเตือน (ถ้ารองรับ)</span>
            </label>
          </div>
        </div>
      </div>
      
      <!-- Status Bar -->
      <div class="status-bar" id="statusBar">
        <div class="status-indicator">
          <div class="status-dot" id="statusDot"></div>
          <span id="statusText">ระบบพร้อมใช้งาน</span>
        </div>
        <p id="nextAlarm" style="margin-top: 10px; color: var(--text-muted); font-size: 0.95rem;">
          ยังไม่มีกำหนดการที่กำลังรอดำเนินการ
        </p>
      </div>
      
      <!-- Action Buttons -->
      <div class="action-buttons">
        <button class="btn btn-primary" id="startBtn" onclick="toggleAlarmSystem()">
          <i class="fas fa-play"></i> เริ่มระบบ
        </button>
        <button class="btn btn-success" onclick="saveAllData()">
          <i class="fas fa-save"></i> บันทึกทั้งหมด
        </button>
        <button class="btn btn-warning" onclick="importExportData()">
          <i class="fas fa-file-export"></i> นำเข้า/ส่งออก
        </button>
        <button class="btn btn-danger" onclick="clearAllData()">
          <i class="fas fa-trash-alt"></i> ล้างทั้งหมด
        </button>
      </div>
    </div>
  </div>
  
  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>
  
  <!-- Hidden Audio Element -->
  <audio id="tempAudio" style="display: none;"></audio>
  
  <script>
    // Application State
    const AppState = {
      sounds: {
        slot1: null,
        slot2: null
      },
      schedules: [],
      isAlarmRunning: false,
      alarmInterval: null,
      currentSlot: 1,
      notifications: {
        notify5min: true,
        notify1min: true,
        repeatSound: false,
        vibrate: false
      },
      triggeredAlarms: new Set(),
      isDarkMode: false,
      isSoundEnabled: true
    };
    
    // Initialize the application
    document.addEventListener('DOMContentLoaded', function() {
      initializeApp();
      updateCurrentTime();
      setInterval(updateCurrentTime, 1000);
    });
    
    // Core Functions
    function initializeApp() {
      loadFromStorage();
      setupEventListeners();
      updateUI();
      checkForNextAlarm();
    }
    
    function updateCurrentTime() {
      const now = new Date();
      const timeString = now.toLocaleTimeString('th-TH', {
        hour12: false,
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
      });
      const dateString = now.toLocaleDateString('th-TH', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });
      
      document.getElementById('current-time').textContent = `${dateString} - ${timeString}`;
    }
    
    // File Upload Functions
    function setupEventListeners() {
      // Upload zone click
      document.getElementById('uploadBtn').addEventListener('click', () => {
        document.getElementById('audioFile').click();
      });
      
      // File input change
      document.getElementById('audioFile').addEventListener('change', handleFileSelect);
      
      // Drag and drop
      const uploadZone = document.getElementById('uploadZone');
      uploadZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadZone.classList.add('dragover');
      });
      
      uploadZone.addEventListener('dragleave', () => {
        uploadZone.classList.remove('dragover');
      });
      
      uploadZone.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadZone.classList.remove('dragover');
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
          handleFileSelect({ target: { files } });
        }
      });
      
      // Theme toggle
      document.getElementById('themeToggle').addEventListener('click', toggleTheme);
      
      // Sound toggle
      document.getElementById('soundToggle').addEventListener('click', toggleSound);
      
      // Notification settings
      document.getElementById('notify5min').addEventListener('change', saveNotificationSettings);
      document.getElementById('notify1min').addEventListener('change', saveNotificationSettings);
      document.getElementById('repeatSound').addEventListener('change', saveNotificationSettings);
      document.getElementById('vibrateNotify').addEventListener('change', saveNotificationSettings);
    }
    
    function handleFileSelect(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      // Validate file
      const validTypes = ['audio/mpeg', 'audio/wav', 'audio/ogg', 'audio/mp3'];
      if (!validTypes.includes(file.type)) {
        showToast('ไฟล์ไม่รองรับ', 'กรุณาเลือกไฟล์เสียง (MP3, WAV, OGG)', 'error');
        return;
      }
      
      if (file.size > 10 * 1024 * 1024) {
        showToast('ไฟล์ใหญ่เกินไป', 'ขนาดไฟล์ต้องไม่เกิน 10MB', 'error');
        return;
      }
      
      // Show progress
      document.getElementById('uploadProgress').style.display = 'block';
      document.getElementById('uploadStatus').textContent = 'กำลังประมวลผลไฟล์...';
      
      simulateUploadProgress(() => {
        processAudioFile(file);
      });
    }
    
    function simulateUploadProgress(onComplete) {
      let progress = 0;
      const progressBar = document.getElementById('progressBar');
      const statusText = document.getElementById('uploadStatus');
      
      const interval = setInterval(() => {
        progress += Math.random() * 20;
        if (progress >= 100) {
          progress = 100;
          clearInterval(interval);
          statusText.textContent = 'ประมวลผลสำเร็จ!';
          
          setTimeout(() => {
            document.getElementById('uploadProgress').style.display = 'none';
            progressBar.style.width = '0%';
            onComplete();
          }, 500);
        }
        
        progressBar.style.width = `${progress}%`;
        statusText.textContent = `กำลังอัปโหลด... ${Math.round(progress)}%`;
      }, 200);
    }
    
    function processAudioFile(file) {
      const slotKey = `slot${AppState.currentSlot}`;
      const oldSound = AppState.sounds[slotKey];
      
      // Revoke old URL if exists
      if (oldSound && oldSound.url) {
        URL.revokeObjectURL(oldSound.url);
      }
      
      const fileUrl = URL.createObjectURL(file);
      const audio = new Audio(fileUrl);
      
      audio.onloadedmetadata = () => {
        const duration = audio.duration;
        const durationText = formatDuration(duration);
        
        AppState.sounds[slotKey] = {
          url: fileUrl,
          name: file.name,
          size: formatFileSize(file.size),
          type: file.type,
          duration: durationText,
          audioElement: audio
        };
        
        updateSoundSlot(AppState.currentSlot);
        showToast('อัปโหลดสำเร็จ', `เพิ่มไฟล์ "${file.name}" ลงในช่องที่ ${AppState.currentSlot}`, 'success');
        saveToStorage();
      };
      
      audio.onerror = () => {
        showToast('ข้อผิดพลาด', 'ไม่สามารถอ่านไฟล์เสียงได้', 'error');
      };
    }
    
    // Sound Slot Functions
    function selectSlot(slotNumber) {
      AppState.currentSlot = slotNumber;
      
      // Update UI
      document.getElementById('soundSlot1').classList.remove('active');
      document.getElementById('soundSlot2').classList.remove('active');
      document.getElementById(`soundSlot${slotNumber}`).classList.add('active');
      
      showToast('เลือกช่องเสียง', `เลือกช่องที่ ${slotNumber} สำหรับอัปโหลด`, 'info');
    }
    
    function updateSoundSlot(slotNumber) {
      const slotKey = `slot${slotNumber}`;
      const sound = AppState.sounds[slotKey];
      const previewDiv = document.getElementById(`audioPreview${slotNumber}`);
      const emptyDiv = document.getElementById(`audioEmpty${slotNumber}`);
      const playBtn = document.getElementById(`playBtn${slotNumber}`);
      const clearBtn = document.getElementById(`clearBtn${slotNumber}`);
      const badge = document.getElementById(`slot${slotNumber}Badge`);
      
      if (sound) {
        // Update preview
        emptyDiv.style.display = 'none';
        previewDiv.innerHTML = `
          <div class="audio-name">${sound.name}</div>
          <div class="audio-meta">
            <span>${sound.duration}</span>
            <span>${sound.size}</span>
          </div>
        `;
        
        // Enable buttons
        playBtn.disabled = false;
        clearBtn.disabled = false;
        
        // Update badge
        badge.textContent = 'พร้อมใช้งาน';
        badge.style.background = 'var(--success-color)';
      } else {
        // Show empty state
        emptyDiv.style.display = 'block';
        previewDiv.innerHTML = '';
        
        // Disable buttons
        playBtn.disabled = true;
        clearBtn.disabled = true;
        
        // Update badge
        badge.textContent = 'ว่าง';
        badge.style.background = 'var(--text-muted)';
      }
    }
    
    function playSound(slotNumber) {
      const slotKey = `slot${slotNumber}`;
      const sound = AppState.sounds[slotKey];
      
      if (!sound || !AppState.isSoundEnabled) return;
      
      try {
        const audio = new Audio(sound.url);
        audio.play().catch(e => {
          showToast('ข้อผิดพลาด', 'ไม่สามารถเล่นเสียงได้', 'error');
        });
      } catch (error) {
        showToast('ข้อผิดพลาด', 'ไม่สามารถเล่นเสียงได้', 'error');
      }
    }
    
    function clearSound(slotNumber) {
      if (!confirm(`ต้องการลบเสียงในช่องที่ ${slotNumber} ใช่หรือไม่?`)) return;
      
      const slotKey = `slot${slotNumber}`;
      const sound = AppState.sounds[slotKey];
      
      if (sound && sound.url) {
        URL.revokeObjectURL(sound.url);
      }
      
      AppState.sounds[slotKey] = null;
      updateSoundSlot(slotNumber);
      saveToStorage();
      showToast('ลบเสียงสำเร็จ', `ลบเสียงออกจากช่องที่ ${slotNumber}`, 'success');
    }
    
    // Schedule Functions
    function addNewSchedule() {
      const newSchedule = {
        id: Date.now().toString(),
        time: '08:00',
        sound: AppState.sounds.slot1 ? 'slot1' : '',
        days: ['mon', 'tue', 'wed', 'thu', 'fri'],
        enabled: true,
        lastTriggered: null
      };
      
      AppState.schedules.push(newSchedule);
      renderScheduleList();
      saveToStorage();
      showToast('เพิ่มกำหนดการ', 'เพิ่มกำหนดการใหม่สำเร็จ', 'success');
    }
    
    function renderScheduleList() {
      const scheduleList = document.getElementById('scheduleList');
      const emptyState = document.getElementById('emptySchedule');
      
      if (AppState.schedules.length === 0) {
        scheduleList.innerHTML = '';
        emptyState.style.display = 'block';
        return;
      }
      
      emptyState.style.display = 'none';
      scheduleList.innerHTML = '';
      
      AppState.schedules.forEach((schedule, index) => {
        const soundName = schedule.sound ? 
          (AppState.sounds[schedule.sound]?.name || 'ไม่พบไฟล์เสียง') : 
          'ยังไม่ได้เลือกเสียง';
        
        const daysText = getDaysText(schedule.days);
        
        const scheduleElement = document.createElement('div');
        scheduleElement.className = 'schedule-item';
        scheduleElement.innerHTML = `
          <div class="schedule-header">
            <div class="schedule-time">${schedule.time}</div>
            <div class="schedule-status">
              <label class="switch">
                <input type="checkbox" ${schedule.enabled ? 'checked' : ''} 
                       onchange="toggleSchedule(${index}, this.checked)">
                <span class="slider"></span>
              </label>
            </div>
          </div>
          <div class="schedule-details">
            <div class="detail-item">
              <div class="detail-label">เสียง</div>
              <div class="detail-value">${soundName}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">วัน</div>
              <div class="detail-value">${daysText}</div>
            </div>
          </div>
          <div class="schedule-actions">
            <button class="btn btn-primary btn-sm" onclick="editSchedule(${index})">
              <i class="fas fa-edit"></i> แก้ไข
            </button>
            <button class="btn btn-danger btn-sm" onclick="deleteSchedule(${index})">
              <i class="fas fa-trash"></i> ลบ
            </button>
          </div>
        `;
        
        scheduleList.appendChild(scheduleElement);
      });
    }
    
    function toggleSchedule(index, enabled) {
      AppState.schedules[index].enabled = enabled;
      saveToStorage();
      checkForNextAlarm();
    }
    
    function editSchedule(index) {
      const schedule = AppState.schedules[index];
      const newTime = prompt('กรุณาใส่เวลา (HH:MM):', schedule.time);
      
      if (newTime && /^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(newTime)) {
        AppState.schedules[index].time = newTime;
        renderScheduleList();
        saveToStorage();
        checkForNextAlarm();
        showToast('แก้ไขสำเร็จ', 'อัปเดตเวลากำหนดการแล้ว', 'success');
      }
    }
    
    function deleteSchedule(index) {
      if (confirm('ต้องการลบกำหนดการนี้ใช่หรือไม่?')) {
        AppState.schedules.splice(index, 1);
        renderScheduleList();
        saveToStorage();
        checkForNextAlarm();
        showToast('ลบสำเร็จ', 'ลบกำหนดการแล้ว', 'success');
      }
    }
    
    // Alarm System Functions
    function toggleAlarmSystem() {
      const startBtn = document.getElementById('startBtn');
      const statusBar = document.getElementById('statusBar');
      const statusDot = document.getElementById('statusDot');
      const statusText = document.getElementById('statusText');
      
      if (AppState.isAlarmRunning) {
        // Stop the alarm system
        clearInterval(AppState.alarmInterval);
        AppState.isAlarmRunning = false;
        
        startBtn.innerHTML = '<i class="fas fa-play"></i> เริ่มระบบ';
        statusBar.classList.remove('running');
        statusDot.classList.remove('running');
        statusText.textContent = 'ระบบหยุดทำงาน';
        
        showToast('ระบบหยุดทำงาน', 'หยุดการตรวจสอบกำหนดการแล้ว', 'info');
      } else {
        // Start the alarm system
        if (AppState.schedules.length === 0) {
          showToast('ไม่สามารถเริ่มระบบ', 'ไม่มีกำหนดการที่ตั้งไว้', 'error');
          return;
        }
        
        // Check if any schedule has sound
        const hasValidSchedule = AppState.schedules.some(schedule => 
          schedule.enabled && schedule.sound && AppState.sounds[schedule.sound]
        );
        
        if (!hasValidSchedule) {
          showToast('ไม่สามารถเริ่มระบบ', 'ไม่มีกำหนดการที่พร้อมใช้งาน', 'error');
          return;
        }
        
        AppState.alarmInterval = setInterval(checkAlarms, 1000);
        AppState.isAlarmRunning = true;
        
        startBtn.innerHTML = '<i class="fas fa-stop"></i> หยุดระบบ';
        statusBar.classList.add('running');
        statusDot.classList.add('running');
        statusText.textContent = 'ระบบกำลังทำงาน';
        
        showToast('ระบบเริ่มทำงาน', 'เริ่มตรวจสอบกำหนดการแล้ว', 'success');
        checkAlarms(); // Initial check
      }
    }
    
    function checkAlarms() {
      const now = new Date();
      const currentTime = now.toTimeString().slice(0, 5); // HH:MM format
      const today = now.getDay(); // 0 = Sunday, 1 = Monday, etc.
      
      AppState.schedules.forEach(schedule => {
        if (!schedule.enabled || !schedule.sound) return;
        
        const scheduleKey = `${schedule.id}-${now.toDateString()}`;
        
        // Check if already triggered today
        if (AppState.triggeredAlarms.has(scheduleKey)) return;
        
        // Check day of week
        const dayMap = { sun: 0, mon: 1, tue: 2, wed: 3, thu: 4, fri: 5, sat: 6 };
        const scheduleDays = schedule.days.map(day => dayMap[day]);
        
        if (!scheduleDays.includes(today)) return;
        
        // Check for notifications
        if (AppState.notifications.notify5min) {
          const fiveMinBefore = addMinutes(schedule.time, -5);
          if (currentTime === fiveMinBefore) {
            showToast('แจ้งเตือนล่วงหน้า', `อีก 5 นาทีจะถึงเวลา ${schedule.time}`, 'info');
          }
        }
        
        if (AppState.notifications.notify1min) {
          const oneMinBefore = addMinutes(schedule.time, -1);
          if (currentTime === oneMinBefore) {
            showToast('แจ้งเตือนล่วงหน้า', `อีก 1 นาทีจะถึงเวลา ${schedule.time}`, 'warning');
          }
        }
        
        // Check for main alarm
        if (currentTime === schedule.time) {
          triggerAlarm(schedule);
          AppState.triggeredAlarms.add(scheduleKey);
          schedule.lastTriggered = new Date().toISOString();
        }
      });
      
      checkForNextAlarm();
    }
    
    function triggerAlarm(schedule) {
      const sound = AppState.sounds[schedule.sound];
      if (!sound) return;
      
      showToast('ถึงเวลาแล้ว!', `เวลา ${schedule.time}`, 'success');
      
      if (AppState.isSoundEnabled) {
        if (AppState.notifications.repeatSound) {
          playSoundRepeatedly(sound.url, 3);
        } else {
          playSound(schedule.sound.replace('slot', ''));
        }
      }
      
      // Trigger vibration if enabled and supported
      if (AppState.notifications.vibrate && 'vibrate' in navigator) {
        navigator.vibrate([200, 100, 200]);
      }
    }
    
    function playSoundRepeatedly(url, times) {
      let count = 0;
      
      function play() {
        if (count >= times) return;
        
        const audio = new Audio(url);
        audio.play();
        count++;
        
        audio.onended = () => {
          setTimeout(play, 500);
        };
      }
      
      play();
    }
    
    function checkForNextAlarm() {
      const now = new Date();
      const nextAlarmElement = document.getElementById('nextAlarm');
      
      if (!AppState.isAlarmRunning || AppState.schedules.length === 0) {
        nextAlarmElement.textContent = 'ยังไม่มีกำหนดการที่กำลังรอดำเนินการ';
        return;
      }
      
      // Find next enabled alarm
      const upcomingAlarms = AppState.schedules
        .filter(schedule => schedule.enabled && schedule.sound)
        .map(schedule => {
          const [hours, minutes] = schedule.time.split(':').map(Number);
          const alarmTime = new Date();
          alarmTime.setHours(hours, minutes, 0, 0);
          
          // If alarm time is in the past, set it for tomorrow
          if (alarmTime < now) {
            alarmTime.setDate(alarmTime.getDate() + 1);
          }
          
          return {
            schedule,
            time: alarmTime
          };
        })
        .sort((a, b) => a.time - b.time);
      
      if (upcomingAlarms.length === 0) {
        nextAlarmElement.textContent = 'ไม่มีกำหนดการที่พร้อมใช้งาน';
        return;
      }
      
      const nextAlarm = upcomingAlarms[0];
      const timeDiff = nextAlarm.time - now;
      const hoursLeft = Math.floor(timeDiff / (1000 * 60 * 60));
      const minutesLeft = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
      
      let timeText = '';
      if (hoursLeft > 0) {
        timeText = `${hoursLeft} ชั่วโมง ${minutesLeft} นาที`;
      } else {
        timeText = `${minutesLeft} นาที`;
      }
      
      const soundName = AppState.sounds[nextAlarm.schedule.sound]?.name || 'ไม่ระบุ';
      nextAlarmElement.textContent = `กำหนดการถัดไป: ${nextAlarm.schedule.time} (${soundName}) - อีก ${timeText}`;
    }
    
    // Utility Functions
    function formatDuration(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${mins}:${secs.toString().padStart(2, '0')}`;
    }
    
    function formatFileSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
      return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
    }
    
    function getDaysText(daysArray) {
      const dayMap = {
        'sun': 'อา', 'mon': 'จ', 'tue': 'อ', 'wed': 'พ', 
        'thu': 'พฤ', 'fri': 'ศ', 'sat': 'ส'
      };
      
      if (daysArray.length === 7) return 'ทุกวัน';
      if (daysArray.length === 5 && 
          !daysArray.includes('sun') && 
          !daysArray.includes('sat')) {
        return 'วันทำงาน';
      }
      
      return daysArray.map(day => dayMap[day] || day).join(', ');
    }
    
    function addMinutes(time, minutes) {
      const [hours, mins] = time.split(':').map(Number);
      const date = new Date();
      date.setHours(hours);
      date.setMinutes(mins + minutes);
      return date.toTimeString().slice(0, 5);
    }
    
    // UI Functions
    function toggleTheme() {
      AppState.isDarkMode = !AppState.isDarkMode;
      document.body.classList.toggle('dark-mode', AppState.isDarkMode);
      
      const icon = document.querySelector('#themeToggle i');
      icon.className = AppState.isDarkMode ? 'fas fa-sun' : 'fas fa-moon';
      
      localStorage.setItem('darkMode', AppState.isDarkMode);
      showToast('เปลี่ยนธีม', AppState.isDarkMode ? 'ธีมมืด' : 'ธีมสว่าง', 'info');
    }
    
    function toggleSound() {
      AppState.isSoundEnabled = !AppState.isSoundEnabled;
      
      const icon = document.querySelector('#soundToggle i');
      icon.className = AppState.isSoundEnabled ? 'fas fa-volume-up' : 'fas fa-volume-mute';
      
      showToast('เสียง', AppState.isSoundEnabled ? 'เปิดเสียงแล้ว' : 'ปิดเสียงแล้ว', 'info');
    }
    
    function showToast(title, message, type = 'info') {
      const toastContainer = document.getElementById('toastContainer');
      const toastId = 'toast-' + Date.now();
      
      const iconMap = {
        'success': 'fas fa-check-circle',
        'error': 'fas fa-exclamation-circle',
        'warning': 'fas fa-exclamation-triangle',
        'info': 'fas fa-info-circle'
      };
      
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.id = toastId;
      toast.innerHTML = `
        <div class="toast-icon">
          <i class="${iconMap[type] || iconMap.info}"></i>
        </div>
        <div class="toast-content">
          <div class="toast-title">${title}</div>
          <div class="toast-message">${message}</div>
        </div>
      `;
      
      toastContainer.appendChild(toast);
      
      // Show toast
      setTimeout(() => {
        toast.classList.add('show');
      }, 10);
      
      // Auto remove after 5 seconds
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
          if (toast.parentNode) {
            toast.parentNode.removeChild(toast);
          }
        }, 400);
      }, 5000);
    }
    
    function updateUI() {
      updateSoundSlot(1);
      updateSoundSlot(2);
      renderScheduleList();
      
      // Set initial slot
      selectSlot(AppState.currentSlot);
      
      // Load theme
      const savedTheme = localStorage.getItem('darkMode');
      if (savedTheme === 'true') {
        AppState.isDarkMode = true;
        document.body.classList.add('dark-mode');
        document.querySelector('#themeToggle i').className = 'fas fa-sun';
      }
    }
    
    // Data Management Functions
    function saveToStorage() {
      try {
        const data = {
          sounds: AppState.sounds,
          schedules: AppState.schedules,
          notifications: AppState.notifications
        };
        
        // Don't save audio URLs (they're blob URLs that won't persist)
        const dataToSave = JSON.parse(JSON.stringify(data));
        delete dataToSave.sounds.slot1?.url;
        delete dataToSave.sounds.slot2?.url;
        delete dataToSave.sounds.slot1?.audioElement;
        delete dataToSave.sounds.slot2?.audioElement;
        
        localStorage.setItem('voiceAlarmData', JSON.stringify(dataToSave));
        return true;
      } catch (error) {
        console.error('Error saving to storage:', error);
        return false;
      }
    }
    
    function loadFromStorage() {
      try {
        const savedData = localStorage.getItem('voiceAlarmData');
        if (savedData) {
          const data = JSON.parse(savedData);
          
          // Load sounds metadata (without URLs)
          if (data.sounds) {
            AppState.sounds = data.sounds;
          }
          
          // Load schedules
          if (data.schedules) {
            AppState.schedules = data.schedules;
          }
          
          // Load notification settings
          if (data.notifications) {
            AppState.notifications = data.notifications;
            document.getElementById('notify5min').checked = data.notifications.notify5min;
            document.getElementById('notify1min').checked = data.notifications.notify1min;
            document.getElementById('repeatSound').checked = data.notifications.repeatSound;
            document.getElementById('vibrateNotify').checked = data.notifications.vibrate;
          }
        }
      } catch (error) {
        console.error('Error loading from storage:', error);
      }
    }
    
    function saveNotificationSettings() {
      AppState.notifications = {
        notify5min: document.getElementById('notify5min').checked,
        notify1min: document.getElementById('notify1min').checked,
        repeatSound: document.getElementById('repeatSound').checked,
        vibrate: document.getElementById('vibrateNotify').checked
      };
      
      saveToStorage();
      showToast('บันทึกการตั้งค่า', 'บันทึกการตั้งค่าการแจ้งเตือนแล้ว', 'success');
    }
    
    function saveAllData() {
      if (saveToStorage()) {
        showToast('บันทึกสำเร็จ', 'บันทึกข้อมูลทั้งหมดแล้ว', 'success');
      } else {
        showToast('ข้อผิดพลาด', 'ไม่สามารถบันทึกข้อมูลได้', 'error');
      }
    }
    
    function importExportData() {
      const action = confirm('ต้องการส่งออกข้อมูลหรือนำเข้าข้อมูล?\n\nกด "ตกลง" เพื่อส่งออกข้อมูล\nกด "ยกเลิก" เพื่อนำเข้าข้อมูล');
      
      if (action) {
        // Export data
        const data = {
          sounds: AppState.sounds,
          schedules: AppState.schedules,
          notifications: AppState.notifications
        };
        
        const dataStr = JSON.stringify(data, null, 2);
        const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
        
        const exportFileDefaultName = `voice-alarm-backup-${new Date().toISOString().slice(0, 10)}.json`;
        
        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', dataUri);
        linkElement.setAttribute('download', exportFileDefaultName);
        linkElement.click();
        
        showToast('ส่งออกสำเร็จ', 'บันทึกข้อมูลสำเร็จแล้ว', 'success');
      } else {
        // Import data
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        
        input.onchange = function(e) {
          const file = e.target.files[0];
          if (!file) return;
          
          const reader = new FileReader();
          reader.onload = function(e) {
            try {
              const importedData = JSON.parse(e.target.result);
              
              // Validate imported data
              if (importedData.schedules && Array.isArray(importedData.schedules)) {
                AppState.schedules = importedData.schedules;
              }
              
              if (importedData.notifications) {
                AppState.notifications = importedData.notifications;
                document.getElementById('notify5min').checked = importedData.notifications.notify5min;
                document.getElementById('notify1min').checked = importedData.notifications.notify1min;
                document.getElementById('repeatSound').checked = importedData.notifications.repeatSound;
                document.getElementById('vibrateNotify').checked = importedData.notifications.vibrate;
              }
              
              // Note: Sounds can't be imported via JSON due to blob URLs
              
              updateUI();
              saveToStorage();
              showToast('นำเข้าสำเร็จ', 'นำเข้าข้อมูลสำเร็จแล้ว', 'success');
            } catch (error) {
              showToast('ข้อผิดพลาด', 'ไม่สามารถอ่านไฟล์ข้อมูลได้', 'error');
            }
          };
          
          reader.readAsText(file);
        };
        
        input.click();
      }
    }
    
    function clearAllData() {
      if (confirm('ต้องการล้างข้อมูลทั้งหมดใช่หรือไม่?\n\nการกระทำนี้ไม่สามารถยกเลิกได้!')) {
        // Stop alarm if running
        if (AppState.isAlarmRunning) {
          clearInterval(AppState.alarmInterval);
          AppState.isAlarmRunning = false;
        }
        
        // Clear sounds
        if (AppState.sounds.slot1 && AppState.sounds.slot1.url) {
          URL.revokeObjectURL(AppState.sounds.slot1.url);
        }
        if (AppState.sounds.slot2 && AppState.sounds.slot2.url) {
          URL.revokeObjectURL(AppState.sounds.slot2.url);
        }
        
        // Reset state
        AppState.sounds = { slot1: null, slot2: null };
        AppState.schedules = [];
        AppState.triggeredAlarms.clear();
        
        // Clear storage
        localStorage.removeItem('voiceAlarmData');
        
        // Reset UI
        updateUI();
        document.getElementById('startBtn').innerHTML = '<i class="fas fa-play"></i> เริ่มระบบ';
        document.getElementById('statusBar').classList.remove('running');
        document.getElementById('statusDot').classList.remove('running');
        document.getElementById('statusText').textContent = 'ระบบพร้อมใช้งาน';
        document.getElementById('nextAlarm').textContent = 'ยังไม่มีกำหนดการที่กำลังรอดำเนินการ';
        
        showToast('ล้างข้อมูลสำเร็จ', 'ล้างข้อมูลทั้งหมดแล้ว', 'success');
      }
    }
    
    // Add CSS for switch
    const style = document.createElement('style');
    style.textContent = `
      .switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 24px;
      }
      
      .switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      
      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 24px;
      }
      
      .slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
      }
      
      input:checked + .slider {
        background-color: var(--success-color);
      }
      
      input:checked + .slider:before {
        transform: translateX(26px);
      }
    `;
    document.head.appendChild(style);
  </script>
</body>
</html>